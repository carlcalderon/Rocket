# Rocket

A simple yet sophisticated tool for building, compiling & minifying projects.

## What is Rocket?

Rocket is a [node.js][nodejs] based universal compiler, builder & minifier offering functionality similar to [CodeKit][codekit] and [Springboard][springboard]. The sugar that separates Rocket from *the rest* lies at the core of its flexibility. Read on for guaranteed gaspsâ€¦

## Install

Firstly, you will need [node.js][nodejs]. Once installed, run the following command:

 	sudo git clone -b "deploy" git://github.com/carlcalderon/Rocket.git /usr/local/lib/rocket; sudo ln -s /usr/local/lib/rocket/rocket /usr/local/bin/rocket
 	
This will install Rocket to your user directory and make it available everywhere.

To update Rocket, open up the terminal and run:

	rocket --update

If you encounter exec permission issues, try the following:

	sudo chmod +x /usr/local/lib/rocket/rocket

## Usage

To use Rocket, simply open up the terminal and run:

	rocket [ options... ] <path_to_config>

### Options

| Option       | Shorthand | Description                                                                                    |
| :----------- | :-------- | :--------------------------------------------------------------------------------------------- |
| \--schematic | -s        | Outputs a schematic describing the build order & output from the specified configuration file. |
| \--approve   | -a        | Automatically approves the schematic.                                                          |
| \--watch     | -w        | Starts watch mode after the first successful build.                                            |
| \--version   | -V        | Outputs the current version.                                                                   |
| \--update    | -u        | Updates Rocket to the current release version.                                                 |

#### Schematic

`--schematic` By specifying this flag, Rocket will merely print the build order or *schematic* generated by the provided configuration file. This is useful when you are unsure of the configuration setup and want to validate the output prior to compilation.

**NOTE:** Rocket automatically informs you and asks for permission prior to compilation **unless** the `-a` flag has been set.

#### Approve

`--approve` This option automatically approves the schematic. This is useful when you are confident that your configuration file is working.

#### Watch

`--watch` This feature uses the [node.js][nodejs] watch methods for listening to changes to files & folders. Following a change, Rocket will present the schematic, ask for your approval (**unless** the `-a` option is specified) and enter watch mode after the first successful build.

## Configuration

Rocket's only requirement is a single JSON configuration file. It really is that simple!

### Basic Example

```json
{
	"input_dir": "source",
	"output_dir": "deploy",
	"build": [
		"index.html",
		"images",
		{
			"input": "coffee/scripts.coffee",
			"output": "js/scripts.js",
			"minify": true
		},
		{
			"input": [
				"less/mixins.less",
				"less/styles.less"
			],
			"output": "css/styles.css"
		}
	]
}
```

In this example, the **configuration file** would exist at the **root** of the project - in the same folder as the **source directory**.

The above JSON structure defines the following:

* An input **directory**
* An output **directory**
* An html **file**
* An images **directory**
* A coffee script **file**
* A couple of less **files**

The second thing to notice is that the objects in *build* array do not share the same setup:

1. First we have the index.html file which will be parsed for notation blocks and then copied to the output folder.
2. Next we have an images directory which will be cloned to the output directory.
3. We then have a single .coffee file which will be **compiled** and **minified** into a file named scripts.js.
4. Finally, we have two separate less files that will be **compiled** into a file named styles.css.

To conclude, this configuration file would output the following:

```
deploy/index.html
deploy/images/...
deploy/js/scripts.js
deploy/css/styles.css
```

### Options

The root JSON object may specify the following fields:

| Field       | Description                         | Optional | Default           |
| :---------- | :---------------------------------- | :------: | :---------------- |
| base_dir    | Directory to run Rocket from.       | true     | "."               |
| input_dir   | Source directory.                   | false    |                   |
| output_dir  | Target directory.                   | true     | "./deploy"        |
| compilers   | List of custom compilers.           | true     |                   |
| build       | Build orders. What to be done.      | false    |                   |

The `build` field specified in a configuration file may contain either Objects or Strings. If a string; Rocket will automatically derive whether it is a **file** or a **folder** and perform the appropriate tasks pending on the type. Folders will be copied recursively and files will be parsed for notation blocks before being copied directly to a mirrored path in the `output_dir`.

#### Adding Files & Folders

Files & folders may hold the following fields:

| Field       | Description                         | Optional | Type                                    |
| :---------- | :---------------------------------- | :------: | :-------------------------------------- |
| input       | Source path.                        | false    | Array or String (relative to input_dir) |
| output      | Target path.                        | false    | String (relative to output_dir)         |
| minify      | Minify the output.                  | true     | Boolean                                 |
| compiler    | Custom compiler ID.                 | true     | String                                  |
| \<custom\>  | Any data used for custom compilers. | true     | Any (99% of the time: String)           |

#### Build Object Examples

The following snippet shows how a folder (*images*) and a file (*index.html*) are specified:

```json
	[...]
	"build": [
		"images",
		"index.html"
	]
```

A file or folder may also be added as an Object specifying even more actions:

```json
	[...]
	"build": [
		{
			"input": [
				"profilepictures",
				"media"
			],
			"output": "images"
		},
		{
			"input": [
				"fragments/header.html",
				"fragments/body.html",
				"fragments/footer.html"
			],
			"output": "index.html"
		}
	]
```

Scripts such as CoffeeScript and LESS offer further configuration:

```json
	[...]
	"build": [
		{
			"input": [
				"coffee/class-one.coffee",
				"coffee/class-two.coffee",
				"coffee/bootstrap.coffee"
			],
			"output": "js/scripts.js",
			"minify": true
		},
		{
			"input": "less/styles.less",
			"output": "css/styles.css",
			"minify": true
		}
	]
```

#### Packaged Compilers

Rocket comes with a collection of commonly used compilers for your convenience. Furthermore, these compilers are automatically selected and employed by the following schema:

| ID            | Task             | invoke by                       |
| :------------ | :--------------- | :------------------------------ |
| uglify        | Minify           | `{minify: true}` on .js output  |
| yuicompressor | Minify           | `{minify: true}` on .css output |
| closure       | Minify           | `{compiler: "closure"}`         |
| coffeescript  | Compile .coffee  | *.coffee as input               |
| less          | Compile .less    | *.less as input                 |

#### Custom Compilers

An **awesome** feature of Rocket is custom compiler configuration.

If you have some CoffeeScript that needs to be compiled with the bare flag (`-b`), you can specify a custom compiler like so:

```json
{
	"input_dir": "source",
	"output_dir": "deploy",
	"compilers": {
		"coffeescript-bare": {
			"executable": "coffee",
			"arguments": "-cb -o {output} {input}"
		}
	},
	"build": [
		{
			"input": "coffee/scripts.coffee",
			"output": "js/scripts.js",
			"compiler": "coffeescript-bare"
		}
	]
}
```

The above example declares a custom compiler with an ID of `coffeescript-bare` and specifies the executable and bespoke arguments. The custom `coffeescript-bare` compiler is then referenced in a build object to be used to compile **scripts.coffee** into **scripts.js**.

The custom compiler can contain any number of custom fields which are shared between the arguments string and the build object it self (**NOTE:** `{input}` and `{output}` are reserved). This allows for shared compiler setups but file-to-file specific arguments. 

The following example shows how a single custom compiler can produce different results by using a custom `message` field:

```json
{
	"input_dir": "source",
	"output_dir": "deploy",
	"compilers": {
		"coffeescript-custom": {
			"executable": "coffee",
			"returnsOutput": true,
			"arguments": "-pe {message}"
		}
	},
	"build": [
		{
			"output": "js/scripts1.js",
			"compiler": "coffeescript-custom",
			"message": "### Hello! ###"
		},
		{
			"output": "js/scripts2.js",
			"compiler": "coffeescript-custom",
			"message": "### World! ###"
		}
	]
}
```

#### Custom Compiler Fields

| Field         | Description                                              | Optional |
| :------------ | :------------------------------------------------------- | :------: |
| executable    | Path to executable.                                      | false    |
| arguments     | Command line arguments.                                  | false    |
| returnsOutput | True if compiler output results.                         | true     |
| extension     | File-extension used to match input files.                | true     |
| minifies      | File-extension used to match input files when minifying. | true     |

## Notation

Rocket (as well as Springboard) provides basic html comment notations to specify inline build actions within files. Rocket recognises both Rocket & Springboard (limited) notation blocks.

### Syntax

```html
<!-- <rocket|sb>: <action> <target|notes> -->
<content>
<!-- end -->
```

### Examples

```html
<!-- rocket: replace js/scripts.js -->
<script type="text/coffeescript" src="coffee/scripts.coffee"></script>
<!-- end -->

<!-- rocket: minify css/styles.css -->
<link rel="stylesheet" type="text/css" href="less/styles.less">
<!-- end -->

<!-- rocket: remove Debug mode -->
<script type="text/javascript">

	var DEBUG_MODE = true;

</script>
<!-- end -->

<!-- rocket: insert -->
header.html
body.html
footer.html
<!-- end -->
```

### Inline Notation Actions

| Action  | Description                                      |
| :------ | :----------------------------------------------- |
| remove  | Removes the content within the block.            |
| replace | Replaces/compiles either scripts or links (css). |
| concat  | Combines the listed files.                       |
| minify  | As *replace* but also minifies.                  |
| insert  | Reads each separated row as a file to include.   |

## Rocket Inception

Unless running in watch mode, all builds are made in order of input. This provides a unique way of nesting build objects. 

The following example shows how the **output** of one build item can be used as the **input** of the next.

```json
{
	"input_dir": "source",
	"output_dir": "deploy",
	"build": [
		{
			"input": "coffee/library.coffee",
			"output": "js/library.js"
		},
		{
			"input": "../deploy/js/library.js",
			"output": "js/library.min.js",
			"minify": true
		}
	]
}
```

Pretty awesome right? Now imagine the following scenario:

1. Rocket performs a build which constructs a new configuration file.
2. In the same build, a new Rocket instance is run as a custom compiler with the `-a` flag targeting the generated configuration file.
3. The new Rocket instance could then perform step 1 and so on and so on...

## Endless Possibilities

Combine custom compilers with the order of compilation and it is easy to see that Rocket can perform the most amazing things. With minimal effort, you can setup a complete build order including LESS, CoffeeScript, compression and even deployment.

### Future

Rocket will always be in favour of developers and evolve along side the community. So please get involved, post a suggestion, or send a pull request!

## Author

Carl Calderon: [@carlcalderon][twitter]

## Contributors

Matthew Wagerfield: [@mwagerfield](http://twitter.com/mwagerfield)

## License

Licensed under the [Apache License, Version 2.0][apache]

[nodejs]: http://nodejs.org/
[codekit]: http://incident57.com/codekit/
[springboard]: https://github.com/soulwire/Springboard
[twitter]: http://twitter.com/carlcalderon
[apache]: http://www.apache.org/licenses/LICENSE-2.0